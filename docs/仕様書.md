# 仕様書

## 1. PWA 構成

### 1.1 Manifest

- ファイル: `manifest.webmanifest`
- 主な定義
  - `name`: Turn Bomber
  - `start_url`: `./`
  - `display`: `standalone`
  - `theme_color`: `#d55e1d`
  - アイコン:
    - `./icons/icon-192.png`
    - `./icons/icon-512.png`
    - `./icons/icon-512-maskable.png`（maskable）

### 1.2 Service Worker

- ファイル: `service-worker.js`
- キャッシュ方針
  - **App Shell**: `index.html`, `src/`配下JS/CSS, manifest, icon をインストール時にキャッシュ
  - **外部依存**: `pixi.mjs` (jsDelivr) を best-effort でキャッシュ
  - **Navigation**: network-first、失敗時はキャッシュ済み `index.html` へフォールバック
  - **静的アセット**: cache-first

### 1.3 SW 更新方針

- 新規 SW 待機時は `SKIP_WAITING` メッセージで即時反映可能。
- `CACHE_NAME` を更新すると旧キャッシュは activate 時に削除される。

## 2. HTML 組み込み仕様

- `index.html` の `<head>` に以下を追加:
  - `meta name="theme-color"`
  - `link rel="manifest"`
  - `apple-mobile-web-app` 系 meta
  - `apple-touch-icon` / `favicon`

## 3. アプリ初期化仕様

- `src/app.js` で `registerServiceWorker()` を呼び出し、`window.load` 後に SW を登録する。
- 登録失敗時は `console.warn` を出し、ゲーム本体の起動は継続する。

## 4. ローカル実行仕様

- Docker Compose で静的配信:
  - `docker-compose.yml`: read-only mount を基本設定
  - `docker-compose.override.yml`: 開発用に書き込み可能 mount へ上書き
  - `.env.sample`: `APP_PORT` を定義
