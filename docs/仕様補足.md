# 仕様補足

このドキュメントは、要件中の曖昧点を実装方針として固定したものです。

## 1. 同時設置で同一マスになった場合

- 条件: 同一 AP ステップで、P1/P2 が同じ座標にボムを置こうとした場合
- 実装: **両者とも設置不成立**
- AP: 設置コスト AP1 は **両者とも消費済み**

理由: 同時解決での優先順位を増やさず、対称性を保つため。

## 2. Boots の「移動+1（2ターン）」の扱い

- 実装: AP加算ではなく、移動専用の追加行動枠 `+1` を 2ターン付与
- コスト消費順: `AP` を先に消費し、APが尽きた後に追加移動枠を消費
- 設置コストには追加移動枠を使えない（設置は AP のみ）

## 3. UI上の移動候補ハイライト

- 候補計算は「現在公開されている盤面情報」を使う
  - 壁（Solid/Soft/Void）・ボムを障害物として扱う
- 実際の有効/無効は `reduce` の同時解決が最終決定

理由: ホットシートで入力中に将来の相手移動を確定できないため。

## 4. 盤面縮小（Void化）の拡張規則

- ターン13開始で 1層目、ターン16開始で 2層目を Void 化
- 以降は 3ターンごとに内側へ 1層ずつ継続
  - `13, 16, 19, 22, ...`
- Void 化セル上のプレイヤーは即死、ボム/アイテムは消滅

## 5. 勝敗判定

- 両者死亡: `draw`
- 片側死亡: 生存側勝利
- 両者生存: `ongoing`

## 6. アイテムの最低保証

- 1試合中に以下の生成数を最低保証する
  - `FireUp`: 2個
  - `Boots`: 1個
  - `Kick`: 1個
- 保証が未達の間は、SoftWall破壊時にドロップを確定させ、不足している種類を優先生成する
- 保証達成後は通常の 30% 抽選に戻る
- 盤面同時存在上限（3個）は維持する

## 7. CPU対戦モード

- UI の Mode で `CPU対戦` を選ぶと、`P2` 入力をスキップして CPU が行動を決定する
- CPUは以下を優先してコマンドを組み立てる
  - 今ターン爆発する爆風（残りタイマー1以下）を回避
  - 相手との距離を詰める
  - アイテム回収と SoftWall 近傍への移動を加点
- ボム設置は、相手を射程で捉えられる場合または SoftWall を複数巻き込める場合に行う

## 8. 同時移動の衝突解決

- 同一ステップで同じ目標マスへ進入した場合は、両者とも移動成立
- すれ違い（互いの開始位置へ同時移動）も成立
- 相手がその場に留まる場合のみ、相手開始位置への進入は不成立

## 9. 自爆ダメージ

- 爆風に自分自身が巻き込まれた場合も即死亡する
- 自爆時の AP ペナルティは廃止する

## 10. ボムタイマー

- ボムの初期タイマーは `1`
- 設置したターン中はタイマーを減らさない
- 次ターンのタイマー更新後に `0` 以下となり爆発する

## 11. 新規対戦時の盤面seed

- UI の新規対戦開始 (`restart`) ごとにランダム seed を払い出して初期盤面を生成する
- 同一セッションでも毎試合で SoftWall 配置が変化する

## 12. CPU の往復抑制

- CPU移動スコアに「直前位置への戻り」および「直近訪問セルへの再侵入」の減点を追加する
- 単純往復を減らし、盤面展開を進めやすくする

## 13. 同時アイテム取得

- 同一ステップで同一セルに到達した両プレイヤーは、同じアイテム効果を同時に取得する
- アイテム自体は 1 個として消費される（盤面からは 1 回だけ消える）
